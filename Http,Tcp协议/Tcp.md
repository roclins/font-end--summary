TCP头部主要由源端口、目的端口、序列号seq，确认号ask、标识符例如ACK、SYN、FIN等ACK、SYN和FIN。

这些大写的单词表示标志位，其值要么是1，要么是0；ack、seq小写的单词表示序号。 

- 序列号seq：seq是这个报文段中第一个字节的数据编号，用于标记数据段的顺序。TCP把连接中发送的所有数据字节都编上一个序号，第一个字节的编号有本地随机产生，以后每一个字节的编号都以此相加。
- 确认号ack：接收到的报文的最后一个字节+1，表示期待收到对方下一个报文段的序号，同时也表示上一个报文已收到。
- 标识符
  - 确认ACK：该字段为1表示确认号字段有效。此外，TCP 还规定在连接建立后传送的所有报文段都必须把 ACK 置为1。 
  - 同步SYN：表示同步序号，用于建立连接。当SYN=1，ACK=0时表示：这是一个连接请求报文段。若同意连接，则在响应报文段中使得SYN=1，ACK=1。因此，SYN=1表示这是一个连接请求，或连接接受报文。SYN这个标志位只有在TCP建产连接时才会被置1，握手完成后SYN标志位被置0。
  - 终止FIN：用来释放一个连接。FIN=1表示：此报文段的发送方的数据已经发送完毕，并要求释放运输连接 



#### 三次握手

TCP是一个全双工的协议，不管是客户端还是服务端，TCP连接建立之后，都能发送和接受数据。

假设主动发起请求的是客户端。一开始，两端都是CLOSED状态，双方会创建TCB。服务端创建完TCB之后会进入LISTEN状态，此时开始等待客户端发送数据。

##### 第一次握手

建立连接时，客户端发送请求报文到服务端。报文中，SYN=1，seq=x（随机产生）；然后客户端进入**SYN_SENT**状态，等待服务器确认 

##### 第二次握手

服务端接受到请求报文后，返还一个报文。报文中，SYN=1，ACK=1，ack=x+1，seq=y（随机产生）；然后客户端进入**SYN_RECV**状态

##### 第三次握手

客户端接收到报文后，再发送一个报文.报文中，ACK=1,ack=y+1，seq=x+1。此包发送完毕，客户端和服务器进入**ESTABLISHED**（TCP连接成功）状态，完成三次握手。 

注：SYN和FIN要占一位。所以，第二次握手的ack=x+1。第三次握手中，因为第一次的SYN占了x这个序号，所以是seq=x+1。

记住：seq是发送者自己的数据编号，同时也应该等于接收到的报文中的ack（因为发送这个报文的一段“问”你要这个编号的数据）

##### 三次握手原因

如果是二次握手：服务端接收到客户端的请求，会返还一个报文，就直接进入**ESTABLISHED**状态，一直等待客户端的请求。但是，如果这个请求是一个无效请求，例如客户端发这个请求后就掉线了，这就会使得服务端一直等待，会造成资源的浪费。所以，就需要第三次请求，客户端再发送一次ACK，告诉服务端我还在，服务端接到后，再进入**ESTABLISHED**状态。



#### 四次再见

